package com.example.drivebackend.mapper;

import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.MappingTarget;
import org.mapstruct.NullValuePropertyMappingStrategy;

import com.example.drivebackend.dto.RepairNoteRequest;
import com.example.drivebackend.dto.RepairNoteResponse;
import com.example.drivebackend.entities.RepairNoteEntity;

@Mapper(componentModel = "spring")
public interface RepairNoteMapper {

    /**
     * Convert RepairNoteRequest to RepairNoteEntity for creation.
     * The ID will be auto-generated by Hibernate.
     *
     * @param request The repair note request from client
     * @param deviceId The device ID from path parameter
     * @return New RepairNoteEntity ready to be saved
     */
    @Mapping(target = "id", ignore = true) // UUID will be auto-generated
    @Mapping(target = "deviceId", source = "deviceId")
    @Mapping(target = "noteText", source = "request.noteText")
    @Mapping(target = "noteDate", source = "request.noteDate")
    @Mapping(target = "notePrice", source = "request.notePrice")
    RepairNoteEntity toEntity(RepairNoteRequest request, String deviceId);

    /**
     * Convert RepairNoteEntity to RepairNoteResponse for API response.
     *
     * @param entity The repair note entity from database
     * @return RepairNoteResponse for client
     */
    RepairNoteResponse toDto(RepairNoteEntity entity);

    /**
     * Update existing RepairNoteEntity from RepairNoteRequest for PATCH operations.
     * Only non-null fields from the request will update the entity.
     *
     * @param request The repair note request with fields to update
     * @param entity The existing entity to update (modified in place)
     */
    @Mapping(target = "id", ignore = true) // Never update the ID
    @Mapping(target = "deviceId", ignore = true) // Never update deviceId
    @Mapping(target = "noteText", source = "noteText", nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)
    @Mapping(target = "noteDate", source = "noteDate", nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)
    @Mapping(target = "notePrice", source = "notePrice", nullValuePropertyMappingStrategy = NullValuePropertyMappingStrategy.IGNORE)
    void updateEntityFromRequest(RepairNoteRequest request, @MappingTarget RepairNoteEntity entity);
}

